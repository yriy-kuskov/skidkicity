-- –°—Ö–µ–º–∞ –¥–ª—è Supabase (–≤—ã–ø–æ–ª–Ω–∏—Ç–µ –≤ SQL Editor –≤ –¥–∞—à–±–æ—Ä–¥–µ Supabase)

-- –¢–∞–±–ª–∏—Ü–∞ –º–∞–≥–∞–∑–∏–Ω–æ–≤
CREATE TABLE IF NOT EXISTS stores (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  name TEXT NOT NULL,
  logo TEXT
);

-- –¢–∞–±–ª–∏—Ü–∞ —Ç–æ–≤–∞—Ä–æ–≤
CREATE TABLE IF NOT EXISTS products (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  barcode TEXT UNIQUE NOT NULL,
  name TEXT NOT NULL,
  category TEXT,
  image_url TEXT
);

-- –¢–∞–±–ª–∏—Ü–∞ —Å–∫–∏–¥–æ–∫ (deals)
CREATE TABLE IF NOT EXISTS deals (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  product_id BIGINT NOT NULL REFERENCES products(id) ON DELETE CASCADE,
  store_id BIGINT NOT NULL REFERENCES stores(id),
  old_price DECIMAL(10,2) NOT NULL,
  new_price DECIMAL(10,2) NOT NULL,
  image_url TEXT,
  created_at TIMESTAMPTZ DEFAULT NOW()
);

-- –ò–Ω–¥–µ–∫—Å—ã
CREATE INDEX IF NOT EXISTS idx_products_barcode ON products(barcode);
CREATE INDEX IF NOT EXISTS idx_deals_created_at ON deals(created_at DESC);

-- –ü–æ–ª–∏—Ç–∏–∫–∏ RLS (–µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω—ã) ‚Äî –ø—Ä–∏–º–µ—Ä –¥–ª—è –ø—É–±–ª–∏—á–Ω–æ–≥–æ —á—Ç–µ–Ω–∏—è –∏ –∞–Ω–æ–Ω–∏–º–Ω–æ–π –∑–∞–ø–∏—Å–∏
-- ALTER TABLE products ENABLE ROW LEVEL SECURITY;
-- ALTER TABLE deals ENABLE ROW LEVEL SECURITY;
-- ALTER TABLE stores ENABLE ROW LEVEL SECURITY;
-- CREATE POLICY "Allow public read" ON products FOR SELECT USING (true);
-- CREATE POLICY "Allow public read" ON deals FOR SELECT USING (true);
-- CREATE POLICY "Allow public read" ON stores FOR SELECT USING (true);
-- CREATE POLICY "Allow anon insert" ON products FOR INSERT WITH CHECK (true);
-- CREATE POLICY "Allow anon insert" ON deals FOR INSERT WITH CHECK (true);

-- –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –º–∞–≥–∞–∑–∏–Ω–æ–≤
INSERT INTO stores (id, name, logo) VALUES
  (1, '–ü—è—Ç—ë—Ä–æ—á–∫–∞', 'üõí'),
  (2, '–ú–∞–≥–Ω–∏—Ç', 'üè™'),
  (3, '–ü–µ—Ä–µ–∫—Ä—ë—Å—Ç–æ–∫', 'üõçÔ∏è'),
  (4, '–õ–µ–Ω—Ç–∞', 'üè¨'),
  (5, '–ê—à–∞–Ω', 'üè¢')
ON CONFLICT (id) DO UPDATE SET name = EXCLUDED.name, logo = EXCLUDED.logo;

-- –ë–∞–∫–µ—Ç deal-images: —Å–æ–∑–¥–∞–π—Ç–µ –≤ Supabase Dashboard ‚Üí Storage ‚Üí New bucket
-- –ò–º—è: deal-images
-- Public bucket: –≤–∫–ª—é—á–∏—Ç—å (–¥–ª—è –ø—É–±–ª–∏—á–Ω—ã—Ö URL –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —Ñ–æ—Ç–æ)

-- 1. –°–æ–∑–¥–∞–µ–º —Ç–∞–±–ª–∏—Ü—É –∫–∞—Ç–µ–≥–æ—Ä–∏–π
CREATE TABLE IF NOT EXISTS categories (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  name TEXT UNIQUE NOT NULL,
  created_at TIMESTAMPTZ DEFAULT NOW()
);

-- 2. –ù–∞–ø–æ–ª–Ω—è–µ–º —Å—Ç–∞—Ä—Ç–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
INSERT INTO categories (name) 
VALUES ('–ú–æ–ª–æ—á–Ω—ã–µ –ø—Ä–æ–¥—É–∫—Ç—ã'), ('–•–ª–µ–±–æ–±—É–ª–æ—á–Ω—ã–µ –∏–∑–¥–µ–ª–∏—è'), ('–ú—è—Å–Ω—ã–µ –∏–∑–¥–µ–ª–∏—è'), 
       ('–û–≤–æ—â–∏ –∏ —Ñ—Ä—É–∫—Ç—ã'), ('–ö—Ä—É–ø—ã'), ('–ù–∞–ø–∏—Ç–∫–∏'), ('–†–∞–∑–Ω–æ–µ')
ON CONFLICT (name) DO NOTHING;

-- 3. –î–æ–±–∞–≤–ª—è–µ–º –∫–æ–ª–æ–Ω–∫—É —Å–≤—è–∑–∏ –≤ products
ALTER TABLE products ADD COLUMN IF NOT EXISTS category_id BIGINT REFERENCES categories(id);

-- 4. –ü–µ—Ä–µ–Ω–æ—Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö (–º–∞–ø–ø–∏–Ω–≥ —Ç–µ–∫—Å—Ç–∞ –≤ ID)
-- –°–Ω–∞—á–∞–ª–∞ —Å–æ–∑–¥–∞–µ–º –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –¥–ª—è –≤—Å–µ—Ö —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –Ω–∞–∑–≤–∞–Ω–∏–π, –∫–æ—Ç–æ—Ä—ã–µ —É–∂–µ –µ—Å—Ç—å –≤ —Ç–æ–≤–∞—Ä–∞—Ö
INSERT INTO categories (name)
SELECT DISTINCT category FROM products 
WHERE category IS NOT NULL
ON CONFLICT (name) DO NOTHING;

-- –ü—Ä–æ—Å—Ç–∞–≤–ª—è–µ–º ID —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∫–∞–∂–¥–æ–º—É —Ç–æ–≤–∞—Ä—É
UPDATE products 
SET category_id = categories.id 
FROM categories 
WHERE products.category = categories.name;

-- 5. –£–î–ê–õ–ï–ù–ò–ï –°–¢–ê–†–û–ô –ö–û–õ–û–ù–ö–ò
-- –¢–µ–ø–µ—Ä—å, –∫–æ–≥–¥–∞ –¥–∞–Ω–Ω—ã–µ –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω—ã –≤ category_id, —Å—Ç–∞—Ä–∞—è —Ç–µ–∫—Å—Ç–æ–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ –Ω–µ –Ω—É–∂–Ω–∞
ALTER TABLE products DROP COLUMN IF EXISTS category;

-- 6. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å (RLS)
ALTER TABLE categories ENABLE ROW LEVEL SECURITY;
CREATE POLICY "Allow public read" ON categories FOR SELECT USING (true);
CREATE POLICY "Allow anon insert" ON categories FOR INSERT WITH CHECK (true);

-- –¥–æ–±–∞–≤–ª—è–µ–º –∫–æ–ª–æ–Ω–∫—É –≤ —Ç–∞–±–ª–∏—Ü—É products, —á—Ç–æ–±—ã —Ö—Ä–∞–Ω–∏—Ç—å —Å—Å—ã–ª–∫—É –Ω–∞ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —à—Ç—Ä–∏—Ö–∫–æ–¥ —Ç–æ–≤–∞—Ä–∞
ALTER TABLE products 
ADD COLUMN IF NOT EXISTS barcode_image_url TEXT;

-- –°–û–ó–î–ê–Å–ú –†–ï–ì–ò–°–¢–†–ê–¶–ò–Æ/–ê–í–¢–û–†–ò–ó–ê–¶–ò–Æ –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–ï–ô
-- 1. –°–æ–∑–¥–∞–µ–º —Ç–∞–±–ª–∏—Ü—É –ø—Ä–æ—Ñ–∏–ª–µ–π
CREATE TABLE public.profiles (
  id uuid REFERENCES auth.users ON DELETE CASCADE PRIMARY KEY,
  email TEXT,
  role TEXT DEFAULT 'user' CHECK (role IN ('user', 'moderator', 'admin')),
  full_name TEXT,
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- 2. –í–∫–ª—é—á–∞–µ–º RLS (Row Level Security)
ALTER TABLE public.profiles ENABLE ROW LEVEL SECURITY;

-- 3. –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –ø–æ–ª–∏—Ç–∏–∫–∏ –¥–æ—Å—Ç—É–ø–∞
CREATE POLICY "–ü—Ä–æ—Ñ–∏–ª–∏ –≤–∏–¥–∏–º—ã –≤—Å–µ–º" ON public.profiles FOR SELECT USING (true);
CREATE POLICY "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç –º–µ–Ω—è—Ç—å —Å–≤–æ–π –ø—Ä–æ—Ñ–∏–ª—å" ON public.profiles FOR UPDATE USING (auth.uid() = id);

-- 4. –§–£–ù–ö–¶–ò–Ø-–¢–†–ò–ì–ì–ï–†: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
CREATE OR REPLACE FUNCTION public.handle_new_user()
RETURNS trigger AS $$
BEGIN
  INSERT INTO public.profiles (id, email, role)
  VALUES (new.id, new.email, 'user');
  RETURN new;
END;
$$ LANGUAGE plpgsql SECURITY DEFINER;

-- 5. –ó–∞–ø—É—Å–∫ —Ç—Ä–∏–≥–≥–µ—Ä–∞
CREATE TRIGGER on_auth_user_created
  AFTER INSERT ON auth.users
  FOR EACH ROW EXECUTE FUNCTION public.handle_new_user();

-- SQL: –°–æ–∑–¥–∞–µ–º —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π ¬´–∫–ª—é—á¬ª –∞–¥–º–∏–Ω–∞
-- –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —Ç–µ–∫—É—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–¥–º–∏–Ω–æ–º
CREATE OR REPLACE FUNCTION public.is_admin()
RETURNS boolean AS $$
BEGIN
  RETURN (
    SELECT (role = 'admin')
    FROM public.profiles
    WHERE id = auth.uid()
  );
END;
$$ LANGUAGE plpgsql SECURITY DEFINER;

-- –¢–µ–ø–µ—Ä—å, –∫–æ–≥–¥–∞ —Ç—ã —Å–æ–∑–¥–∞–µ—à—å –ª—é–±—É—é –Ω–æ–≤—É—é —Ç–∞–±–ª–∏—Ü—É (–∏–ª–∏ –¥–ª—è —Ç–µ–∫—É—â–∏—Ö: deals, stores, products), —Ç–µ–±–µ –Ω—É–∂–Ω–æ –ø—Ä–æ—Å—Ç–æ –≤–∫–ª—é—á–∏—Ç—å RLS –∏ –±–∞—Ö–Ω—É—Ç—å –æ–¥–Ω—É —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—É—é –ø–æ–ª–∏—Ç–∏–∫—É
-- –†–∞–∑—Ä–µ—à–∏—Ç—å –∞–¥–º–∏–Ω—É –í–°–Å –≤ —Ç–∞–±–ª–∏—Ü–µ (–∑–∞–º–µ–Ω–∏ 'deals' –Ω–∞ –∏–º—è –ª—é–±–æ–π —Ç–∞–±–ª–∏—Ü—ã)
CREATE POLICY "Admins have full access" 
ON public.deals 
FOR ALL 
TO authenticated 
USING (public.is_admin());

-- –†–∞–∑—Ä–µ—à–∏—Ç—å –∞–¥–º–∏–Ω—É –í–°–Å –≤ —Ç–∞–±–ª–∏—Ü–µ stores
CREATE POLICY "Admins have full access" 
ON public.stores 
FOR ALL 
TO authenticated 
USING (public.is_admin());

-- –†–∞–∑—Ä–µ—à–∏—Ç—å –∞–¥–º–∏–Ω—É –í–°–Å –≤ —Ç–∞–±–ª–∏—Ü–µ products
CREATE POLICY "Admins have full access" 
ON public.products 
FOR ALL 
TO authenticated 
USING (public.is_admin());

-- –†–∞–∑—Ä–µ—à–∏—Ç—å –∞–¥–º–∏–Ω—É –í–°–Å –≤ —Ç–∞–±–ª–∏—Ü–µ categories
CREATE POLICY "Admins have full access" 
ON public.categories 
FOR ALL 
TO authenticated 
USING (public.is_admin());

-- 1. –í–∫–ª—é—á–∞–µ–º –∑–∞—â–∏—Ç—É –Ω–∞ —Ç–∞–±–ª–∏—Ü–∞—Ö (–µ—Å–ª–∏ –µ—â–µ –Ω–µ –≤–∫–ª—é—á–µ–Ω–∞)
-- 1. –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ–º, —á—Ç–æ RLS –≤–∫–ª—é—á–µ–Ω (—á—Ç–æ–±—ã –ø—Ä–∞–≤–∏–ª–∞ —Ä–∞–±–æ—Ç–∞–ª–∏ –æ–¥–∏–Ω–∞–∫–æ–≤–æ –¥–ª—è –≤—Å–µ—Ö)
ALTER TABLE public.deals ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.stores ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.categories ENABLE ROW LEVEL SECURITY;
ALTER TABLE public.products ENABLE ROW LEVEL SECURITY;

-- 2. –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—É—é—â–∏–µ –ø–æ–ª–∏—Ç–∏–∫–∏ (—á—Ç–æ–±—ã –Ω–µ –±—ã–ª–æ –æ—à–∏–±–æ–∫ duplicate)
DROP POLICY IF EXISTS "–í—Å–µ –º–æ–≥—É—Ç —Å–º–æ—Ç—Ä–µ—Ç—å —Å–∫–∏–¥–∫–∏" ON public.deals;
DROP POLICY IF EXISTS "–í—Å–µ –º–æ–≥—É—Ç —Å–º–æ—Ç—Ä–µ—Ç—å –º–∞–≥–∞–∑–∏–Ω—ã" ON public.stores;
DROP POLICY IF EXISTS "–í—Å–µ –º–æ–≥—É—Ç —Å–º–æ—Ç—Ä–µ—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏–∏" ON public.categories;
DROP POLICY IF EXISTS "–í—Å–µ –º–æ–≥—É—Ç —Å–º–æ—Ç—Ä–µ—Ç—å —Ç–æ–≤–∞—Ä—ã" ON public.products;

-- 3. –°–æ–∑–¥–∞–µ–º –ì–õ–û–ë–ê–õ–¨–ù–´–ï —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –Ω–∞ —á—Ç–µ–Ω–∏–µ
-- "TO public" –æ–∑–Ω–∞—á–∞–µ—Ç "–ò –¥–ª—è –≥–æ—Å—Ç–µ–π, –∏ –¥–ª—è –∑–∞–ª–æ–≥–∏–Ω–µ–Ω–Ω—ã—Ö"
CREATE POLICY "Public Read Access Deals" 
ON public.deals FOR SELECT 
TO public 
USING (true);

CREATE POLICY "Public Read Access Stores" 
ON public.stores FOR SELECT 
TO public 
USING (true);

CREATE POLICY "Public Read Access Categories" 
ON public.categories FOR SELECT 
TO public 
USING (true);

CREATE POLICY "Public Read Access Products" 
ON public.products FOR SELECT 
TO public 
USING (true);

-- –†–∞–∑—Ä–µ—à–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º —á–∏—Ç–∞—Ç—å –°–í–û–ô —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π –ø—Ä–æ—Ñ–∏–ª—å
-- –≠—Ç–æ –∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è —Ç–æ–≥–æ, —á—Ç–æ–±—ã useAuth –º–æ–≥ —É–∑–Ω–∞—Ç—å —Ä–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
DROP POLICY IF EXISTS "Users can view own profile" ON public.profiles;

CREATE POLICY "Users can view own profile" 
ON public.profiles FOR SELECT 
USING (auth.uid() = id);

-- –ù–∞ –≤—Å—è–∫–∏–π —Å–ª—É—á–∞–π —Ä–∞–∑—Ä–µ—à–∏–º –≤—Å—Ç–∞–≤–∫—É —Å–∞–º–æ–º—É —Å–µ–±–µ (–¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏)
DROP POLICY IF EXISTS "Users can insert own profile" ON public.profiles;
CREATE POLICY "Users can insert own profile" 
ON public.profiles FOR INSERT 
WITH CHECK (auth.uid() = id);

-- 1. –£–¥–∞–ª—è–µ–º –í–û–û–ë–©–ï –í–°–ï –ø–æ–ª–∏—Ç–∏–∫–∏ —Å —Ç–∞–±–ª–∏—Ü—ã profiles
DO $$ 
DECLARE pol record;
BEGIN 
    FOR pol IN SELECT policyname FROM pg_policies WHERE tablename = 'profiles' 
    LOOP
        EXECUTE format('DROP POLICY %I ON public.profiles', pol.policyname);
    END LOOP;
END $$;

-- 2. –í–∫–ª—é—á–∞–µ–º RLS –∑–∞–Ω–æ–≤–æ
ALTER TABLE public.profiles ENABLE ROW LEVEL SECURITY;

-- 3. –°–æ–∑–¥–∞–µ–º –û–î–ù–£ –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—É—é –ø–æ–ª–∏—Ç–∏–∫—É: –∫–∞–∂–¥—ã–π –≤–∏–¥–∏—Ç —Ç–æ–ª—å–∫–æ —Å–µ–±—è
-- –≠—Ç–æ –∏—Å–∫–ª—é—á–∞–µ—Ç –≤—ã–∑–æ–≤ —Ñ—É–Ω–∫—Ü–∏–π –∏ —Ä–µ–∫—É—Ä—Å–∏—é
CREATE POLICY "allow_self_read" 
ON public.profiles FOR SELECT 
TO authenticated 
USING (auth.uid() = id);

-- 4. –î–∞–µ–º –∞–¥–º–∏–Ω–∞–º (—Å–µ—Ä–≤–∏—Å–Ω–æ–π —Ä–æ–ª–∏) –¥–æ—Å—Ç—É–ø –∫–æ –≤—Å–µ–º—É (–¥–ª—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö –Ω—É–∂–¥ Supabase)
CREATE POLICY "allow_admin_service" 
ON public.profiles FOR ALL 
TO service_role 
USING (true);

-- –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã —Ç–∏–ø–æ–≤ —Å–∫–∏–¥–æ–∫
CREATE TABLE IF NOT EXISTS deal_types (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    name TEXT NOT NULL UNIQUE, -- '2 –ø–æ —Ü–µ–Ω–µ 1', '–°–∫–∏–¥–∫–∞ %', '–ü–æ–¥–∞—Ä–æ–∫'
    description TEXT,
    created_at TIMESTAMPTZ DEFAULT NOW()
);

-- –ù–∞–ø–æ–ª–Ω–∏–º –±–∞–∑–æ–≤—ã–º–∏ —Ç–∏–ø–∞–º–∏
INSERT INTO deal_types (name, description) VALUES
('–°–Ω–∏–∂–µ–Ω–∏–µ —Ü–µ–Ω—ã', '–ü—Ä–æ—Å—Ç–æ–µ —É–º–µ–Ω—å—à–µ–Ω–∏–µ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ —Ç–æ–≤–∞—Ä–∞'),
('2 –ø–æ —Ü–µ–Ω–µ 1', '–ü—Ä–∏ –ø–æ–∫—É–ø–∫–µ –¥–≤—É—Ö –µ–¥–∏–Ω–∏—Ü —Ç–æ–≤–∞—Ä–∞, —Ü–µ–Ω–∞ –∑–∞ –æ–±–µ —Ä–∞–≤–Ω–∞ —Ü–µ–Ω–µ –æ–¥–Ω–æ–π'),
('–ü–æ–¥–∞—Ä–æ–∫ –ø—Ä–∏ –ø–æ–∫—É–ø–∫–µ', '–ü—Ä–∏ –ø–æ–∫—É–ø–∫–µ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Ç–æ–≤–∞—Ä–∞ –≤—ã–¥–∞–µ—Ç—Å—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –≤ –ø–æ–¥–∞—Ä–æ–∫');

-- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Ç–∞–±–ª–∏—Ü
-- –î–æ–±–∞–≤–ª—è–µ–º –Ω—É–∂–Ω—ã–µ –ø–æ–ª—è –∏ —Å–≤—è–∑–∏.
-- –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–æ–¥—É–∫—Ç—ã
ALTER TABLE products 
ADD COLUMN IF NOT EXISTS description TEXT;

-- –û–±–Ω–æ–≤–ª—è–µ–º –º–∞–≥–∞–∑–∏–Ω—ã
ALTER TABLE stores 
ADD COLUMN IF NOT EXISTS address TEXT,
ADD COLUMN IF NOT EXISTS description TEXT,
ADD COLUMN IF NOT EXISTS parent_id BIGINT REFERENCES stores(id); 
-- parent_id –ø–æ–∑–≤–æ–ª–∏—Ç —Å–≤—è–∑–∞—Ç—å "–ü—è—Ç–µ—Ä–æ—á–∫—É –Ω–∞ –õ–µ–Ω–∏–Ω–∞" —Å "–ì–ª–∞–≤–Ω—ã–º –æ—Ñ–∏—Å–æ–º –ü—è—Ç–µ—Ä–æ—á–∫–∏" (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

-- –û–±–Ω–æ–≤–ª—è–µ–º —Å–∫–∏–¥–∫–∏ (deals)
ALTER TABLE deals 
ADD COLUMN IF NOT EXISTS discount_value NUMERIC, -- –î–ª—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, 25.5 –¥–ª—è 25.5%)
ADD COLUMN IF NOT EXISTS description TEXT,
ADD COLUMN IF NOT EXISTS is_active BOOLEAN DEFAULT true,
ADD COLUMN IF NOT EXISTS deal_type_id BIGINT REFERENCES deal_types(id);